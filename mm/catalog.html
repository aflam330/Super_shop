<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catalog - Super Shop</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="js/realtime.js"></script>
  <style>
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .truncate {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .product:hover {
      transform: translateY(-2px);
    }
    .product {
      transition: all 0.3s ease;
    }
  </style>
  <script>
    let products = [];
    
    // Fetch products from API
    async function fetchProducts(category = 'all', search = '') {
      try {
        // Show loading indicator
        document.getElementById('loading').classList.remove('hidden');
        document.getElementById('no-products').classList.add('hidden');
        
        let url = 'backend/api/products.php';
        const params = new URLSearchParams();
        if (category && category !== 'all') params.append('category', category);
        if (search) params.append('search', search);
        if (params.toString()) url += '?' + params.toString();
        
        const response = await fetch(url);
        const data = await response.json();
        
        // Hide loading indicator
        document.getElementById('loading').classList.add('hidden');
        
        if (data.success) {
          products = data.data;
          displayProducts();
          
          // Show no products message if no results
          if (products.length === 0) {
            document.getElementById('no-products').classList.remove('hidden');
          }
        } else {
          console.error('Failed to fetch products:', data.error);
          document.getElementById('no-products').classList.remove('hidden');
        }
      } catch (error) {
        console.error('Error fetching products:', error);
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('no-products').classList.remove('hidden');
      }
    }
    
    // Display products in the grid
    function displayProducts() {
      const container = document.getElementById('products-container');
      container.innerHTML = '';
      
      // Track used image URLs within this render to avoid duplicates
      const usedImageUrls = new Set();
      
      products.forEach(product => {
        const productCard = createProductCard(product, usedImageUrls);
        container.appendChild(productCard);
      });
    }
    
    // Create a product card element
    function createProductCard(product, usedImageUrls) {
      const card = document.createElement('div');
      card.className = 'product bg-white p-4 rounded shadow hover:shadow-lg transition-shadow';
      card.setAttribute('data-cat', product.category.toLowerCase().replace(/\s+/g, '-'));
      card.setAttribute('data-product-id', product.id);
      
      // Generate a unique, relevant image URL per card (avoid repeats across the grid)
      const imageUrl = selectImageUrl(product, usedImageUrls);
      
             card.innerHTML = `
         <div class="relative">
           <img src="${imageUrl}" alt="${product.name}" 
                class="mb-2 rounded w-full h-48 object-cover bg-gray-100 transition-opacity duration-300" 
                onload="this.style.opacity='1'" 
                onerror="this.src='https://via.placeholder.com/300/6B7280/FFFFFF?text=${encodeURIComponent(product.name)}'; this.style.opacity='1'"
                style="opacity: 0;">
           <div class="absolute inset-0 bg-gray-200 rounded animate-pulse" style="display: none;"></div>
         </div>
         <div class="font-semibold text-gray-800 truncate">${product.name}</div>
         <div class="text-sm text-gray-600 mb-1 line-clamp-2">${product.description || ''}</div>
         <div class="stock text-green-600 text-sm">Stock: ${product.stock_quantity}</div>
         <div class="text-gray-700 mb-2 font-bold">à§³${parseFloat(product.price).toFixed(2)}</div>
         <button onclick="addToCart(${product.id}, '${product.name}', ${product.price})" 
                 class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors w-full">
           Add to Cart
         </button>
       `;
      
      return card;
    }
    
    // Pick a unique image per product card (deduplicate across current render)
    function selectImageUrl(product, usedImageUrls) {
      if (product.image_url && usedImageUrls && !usedImageUrls.has(product.image_url)) {
        usedImageUrls.add(product.image_url);
        return product.image_url;
      }
      return generateImageUrl(product, usedImageUrls);
    }

    // Generate image URL based on product category and name
    function generateImageUrl(product, usedImageUrls) {
      const category = product.category.toLowerCase();
      const name = product.name.toLowerCase();
      
      // Simple deterministic hash from product id/name
      function hashString(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = ((hash << 5) - hash) + str.charCodeAt(i);
          hash |= 0;
        }
        return Math.abs(hash);
      }
      const seed = hashString(String(product.id ?? product.name));
      
      // Comprehensive image mappings for different product categories
      const imageMappings = {
        'electronics': {
          'laptop': [
            'https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=300&h=300&fit=crop'
          ],
          'smartphone': [
            'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1512496015851-a90fb38ba796?w=300&h=300&fit=crop'
          ],
          'phone': [
            'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1512496015851-a90fb38ba796?w=300&h=300&fit=crop'
          ],
          'headphones': [
            'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1518441310475-1573b1cf9f71?w=300&h=300&fit=crop'
          ],
          'speaker': [
            'https://images.unsplash.com/photo-1608043152269-423dbba4e7e1?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1585386959984-a41552231658?w=300&h=300&fit=crop'
          ],
          'watch': [
            'https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?w=300&h=300&fit=crop'
          ],
          'tablet': [
            'https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1510552776732-01acc9a4c1c5?w=300&h=300&fit=crop'
          ],
          'camera': [
            'https://images.unsplash.com/photo-1516035069371-29a1b244cc32?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1519183071298-a2962be96f83?w=300&h=300&fit=crop'
          ],
          'keyboard': [
            'https://images.unsplash.com/photo-1541140532154-b024d705b90a?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1517694712202-14dd9538aa97?w=300&h=300&fit=crop'
          ],
          'mouse': [
            'https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=300&h=300&fit=crop'
          ],
          'gaming': [
            'https://images.unsplash.com/photo-1542751371-adc38448a05e?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1603484477859-abe6a73f936d?w=300&h=300&fit=crop'
          ],
          'default': [
            'https://images.unsplash.com/photo-1498049794561-7780e7231661?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1518779578993-ec3579fee39f?w=300&h=300&fit=crop'
          ]
        },
        'fashion': {
          'shoes': [
            'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1525966222134-fcfa99b8ae77?w=300&h=300&fit=crop'
          ],
          'backpack': [
            'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1519669417670-68775a50919e?w=300&h=300&fit=crop'
          ],
          'sunglasses': [
            'https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1490481651871-ab68de25d43d?w=300&h=300&fit=crop'
          ],
          'watch': [
            'https://images.unsplash.com/photo-1524592094714-0f0654e20314?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1524805444758-089113d48a6d?w=300&h=300&fit=crop'
          ],
          'jacket': [
            'https://images.unsplash.com/photo-1551028719-00167b16eac5?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1520975916090-3105956dac38?w=300&h=300&fit=crop'
          ],
          'shirt': [
            'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1541099649105-f69ad21f3246?w=300&h=300&fit=crop'
          ],
          'dress': [
            'https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1490481651871-ab68de25d43d?w=300&h=300&fit=crop'
          ],
          'jeans': [
            'https://images.unsplash.com/photo-1542272604-787c3835535d?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1514996937319-344454492b37?w=300&h=300&fit=crop'
          ],
          'default': [
            'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1539008835657-9e8e9680c956?w=300&h=300&fit=crop'
          ]
        },
        'home & kitchen': {
          'coffee': [
            'https://images.unsplash.com/photo-1517668808822-9ebb02f2a0e6?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=300&h=300&fit=crop'
          ],
          'lamp': [
            'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1484101403633-562f891dc89a?w=300&h=300&fit=crop'
          ],
          'chair': [
            'https://images.unsplash.com/photo-1567538096630-e0c55bd6374c?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1519710164239-da123dc03ef4?w=300&h=300&fit=crop'
          ],
          'table': [
            'https://images.unsplash.com/photo-1533090481720-856c6e3c1fdc?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1505691938895-1758d7feb511?w=300&h=300&fit=crop'
          ],
          'sofa': [
            'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1484101403633-562f891dc89a?w=300&h=300&fit=crop'
          ],
          'default': [
            'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1449247613801-ab06418e2861?w=300&h=300&fit=crop'
          ]
        },
        'sports': {
          'yoga': [
            'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1518611012118-696072aa579a?w=300&h=300&fit=crop'
          ],
          'dumbbells': [
            'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1517960413843-0aee8e2b3285?w=300&h=300&fit=crop'
          ],
          'basketball': [
            'https://images.unsplash.com/photo-1546519638-68e109498ffc?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1517649763962-0c623066013b?w=300&h=300&fit=crop'
          ],
          'tennis': [
            'https://images.unsplash.com/photo-1551698618-1dfe5d97d256?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1505664194779-8beaceb93744?w=300&h=300&fit=crop'
          ],
          'bike': [
            'https://images.unsplash.com/photo-1532298229144-0ec0c57515c7?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1520975928316-56f6b42e9fbd?w=300&h=300&fit=crop'
          ],
          'default': [
            'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1517649763962-0c623066013b?w=300&h=300&fit=crop'
          ]
        },
        'books': {
          'book': [
            'https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1519681393784-d120267933ba?w=300&h=300&fit=crop'
          ],
          'notebook': [
            'https://images.unsplash.com/photo-1531346680769-a1d79b57de5c?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1501877008226-4fca48ee50c1?w=300&h=300&fit=crop'
          ],
          'stationery': [
            'https://images.unsplash.com/photo-1531346680769-a1d79b57de5c?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?w=300&h=300&fit=crop'
          ],
          'default': [
            'https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=300&h=300&fit=crop',
            'https://images.unsplash.com/photo-1457694587812-e8bf29a43845?w=300&h=300&fit=crop'
          ]
        }
      };
      
      // Build candidate URLs based on category and keywords
      let candidates = [];
      if (imageMappings[category]) {
        const categoryImages = imageMappings[category];
        for (const [keyword, urls] of Object.entries(categoryImages)) {
          if (keyword !== 'default' && name.includes(keyword) && Array.isArray(urls)) {
            candidates = candidates.concat(urls);
          }
        }
        if (candidates.length === 0 && Array.isArray(categoryImages.default)) {
          candidates = candidates.concat(categoryImages.default);
        }
      }
      if (candidates.length === 0) {
        candidates = [
          'https://images.unsplash.com/photo-1498049794561-7780e7231661?w=300&h=300&fit=crop',
          'https://images.unsplash.com/photo-1518779578993-ec3579fee39f?w=300&h=300&fit=crop'
        ];
      }
      
      // Deterministically pick a variant, avoid duplicates in this render
      let index = seed % candidates.length;
      let chosen = candidates[index];
      if (usedImageUrls && usedImageUrls.has(chosen)) {
        for (let offset = 1; offset < candidates.length; offset++) {
          const candidate = candidates[(index + offset) % candidates.length];
          if (!usedImageUrls.has(candidate)) {
            chosen = candidate;
            break;
          }
        }
      }
      if (usedImageUrls) usedImageUrls.add(chosen);
      return chosen;
    }
    
    // Filter products by category
    function filterCatalog() {
      const category = document.getElementById('cat').value;
      const search = document.getElementById('search').value;
      fetchProducts(category, search);
    }
    
    // Search products
    function searchProducts() {
      const category = document.getElementById('cat').value;
      const search = document.getElementById('search').value;
      fetchProducts(category, search);
    }
    
    // Add to cart functionality
    function addToCart(productId, productName, price) {
      let cart = JSON.parse(localStorage.getItem('cart') || '[]');
      let existingItem = cart.find(item => item.id === productId);
      
      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({
          id: productId,
          name: productName,
          price: parseFloat(price),
          quantity: 1
        });
      }
      
      localStorage.setItem('cart', JSON.stringify(cart));
      
      // Show notification
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 bg-green-500 text-white p-4 rounded shadow-lg z-50';
      notification.innerHTML = `${productName} added to cart!`;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 2000);
    }
    
    // Initialize page
    window.onload = function() {
      fetchProducts();
    };
  </script>
</head>
<body class="bg-gray-100 min-h-screen">
  <nav class="flex items-center justify-between p-4 bg-white shadow">
            <button onclick="window.location.href='index.html'" class="text-2xl font-bold text-blue-700 hover:text-blue-800 transition-colors cursor-pointer">Super Shop</button>
    <div>
      <a href="index.html" class="mx-2 text-gray-700 hover:text-blue-700">Home</a>
      <a href="cart.html" class="mx-2 text-gray-700 hover:text-blue-700">Cart</a>
      <a href="orders.html" class="mx-2 text-gray-700 hover:text-blue-700">Orders</a>
      <a href="returns.html" class="mx-2 text-gray-700 hover:text-blue-700">Returns</a>
      <a href="feedback.html" class="mx-2 text-gray-700 hover:text-blue-700">Feedback</a>
    </div>
  </nav>
  
  <main class="max-w-7xl mx-auto py-8">
    <h1 class="text-2xl font-bold mb-4">Product Catalog</h1>
    
    <div class="mb-4 flex gap-4 items-center flex-wrap">
      <label for="cat" class="font-medium">Category:</label>
      <select id="cat" onchange="filterCatalog()" class="border p-2 rounded">
        <option value="all">All Categories</option>
        <option value="Electronics">Electronics</option>
        <option value="Fashion">Fashion</option>
        <option value="Home & Kitchen">Home & Kitchen</option>
        <option value="Sports">Sports</option>
        <option value="Books">Books</option>
      </select>
      
      <input type="text" id="search" placeholder="Search products..." 
             class="border p-2 rounded flex-1 min-w-200" 
             oninput="searchProducts()">
      </div>
      
    <!-- Loading indicator -->
    <div id="loading" class="text-center py-8">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <p class="mt-2 text-gray-600">Loading products...</p>
      </div>
      
    <!-- Products grid -->
    <div id="products-container" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
      <!-- Products will be dynamically loaded here -->
      </div>
      
    <!-- No products message -->
    <div id="no-products" class="text-center py-8 hidden">
      <p class="text-gray-600 text-lg">No products found matching your criteria.</p>
    </div>
  </main>
  
  <footer class="text-center p-4 bg-white shadow mt-8">&copy; 2024 Super Shop. All rights reserved.</footer>
</body>
</html> 